<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IP Lookup Tool</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>IP Lookup Tool</h1>
    <div class="form-group">
      <input type="text" id="ipInput" placeholder="Enter IP address" />
      <button onclick="lookupIP()">Lookup</button>
      <button onclick="exportResult()">Export</button>
    </div>
    <div id="result" class="result"></div>
  </div>

  <script>
    async function lookupIP() {
      const ip = document.getElementById('ipInput').value;
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = "Loading...";
      
      try {
        const response = await fetch(`https://ipwhois.app/json/${ip}`);
        const data = await response.json();

        if (data.success === false) {
          resultDiv.innerHTML = `<div class='error'>Error: ${data.message}</div>`;
          return;
        }

        resultDiv.innerHTML = `
          <table>
            <tr><td><strong>IP:</strong></td><td>${data.ip}</td></tr>
            <tr><td><strong>Type:</strong></td><td>${data.type}</td></tr>
            <tr><td><strong>Continent:</strong></td><td>${data.continent} (${data.continent_code})</td></tr>
            <tr><td><strong>Country:</strong></td><td>${data.country} (${data.country_code})</td></tr>
            <tr><td><strong>Region:</strong></td><td>${data.region}</td></tr>
            <tr><td><strong>City:</strong></td><td>${data.city}</td></tr>
            <tr><td><strong>Latitude:</strong></td><td>${data.latitude}</td></tr>
            <tr><td><strong>Longitude:</strong></td><td>${data.longitude}</td></tr>
            <tr><td><strong>ASN:</strong></td><td>${data.asn}</td></tr>
            <tr><td><strong>Org:</strong></td><td>${data.org}</td></tr>
            <tr><td><strong>ISP:</strong></td><td>${data.isp}</td></tr>
            <tr><td><strong>Timezone:</strong></td><td>${data.timezone}</td></tr>
            <tr><td><strong>Currency:</strong></td><td>${data.currency}</td></tr>
          </table>
        `;

        window.latestData = data;
      } catch (err) {
        resultDiv.innerHTML = `<div class='error'>Error: ${err.message}</div>`;
      }
    }

    function exportResult() {
      if (!window.latestData) {
        alert("No data to export.");
        return;
      }

      const exportWindow = window.open("export.html");
      exportWindow.onload = function() {
        exportWindow.postMessage(window.latestData, "*");
      }
    }
  </script>
</body>
</html>
